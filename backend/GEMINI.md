# NeuroVox Backend

## Project Overview
**NeuroVox Backend** is a local Node.js server designed to power the NeuroVox Obsidian plugin. It provides private, offline audio transcription using quantized Whisper models via the Hugging Face Transformers library. The server handles audio file uploads, decodes them using FFmpeg, and runs inference locally on the CPU.

## Technology Stack
- **Runtime:** Node.js (v18+)
- **Language:** TypeScript
- **Framework:** Express.js
- **AI/ML:** `@huggingface/transformers` (Whisper models)
- **Audio Processing:** `fluent-ffmpeg`, `@ffmpeg-installer/ffmpeg`
- **Logging:** `winston`

## Key Files & Directories
- **`src/server.ts`**: Application entry point. Sets up Express, middleware, and routes.
- **`src/whisper.ts`**: Core transcription service. Handles model initialization, audio decoding (WAV/PCM), and pipeline execution.
- **`src/config.ts`**: Configuration constants (ports, paths, model names).
- **`src/routes/`**: API route definitions (`transcribe.ts`, `health.ts`).
- **`models/`**: Local cache directory for downloaded Whisper models.
- **`dist/`**: Compiled JavaScript output (generated by build).

## Setup & Usage

### Installation
1.  Install dependencies:
    ```bash
    npm install
    ```

### Development
Run the server in development mode (using `ts-node`):
```bash
npm run dev
```
*   Starts server on `http://localhost:3847` (default).
*   Downloads the model on first run (can take a few minutes).

### Production Build
1.  Compile TypeScript to JavaScript:
    ```bash
    npm run build
    ```
2.  Start the compiled server:
    ```bash
    npm start
    ```

## API Endpoints
- **GET `/api/health`**: Check server status and model loading state.
- **POST `/api/transcribe`**: Upload audio file for transcription.
    -   **Content-Type**: `multipart/form-data`
    -   **Body**: `audio` (file)

## Development Conventions
-   **Logging**: Use the `logger` utility from `src/utils/logger.ts` instead of `console.log`.
-   **Type Safety**: Maintain strict TypeScript types. `tsconfig.json` enforces strict mode.
-   **Error Handling**: Use the global error handler middleware.
-   **Model Handling**: The application supports different Whisper model versions/sizes. Configuration is managed via `src/config.ts`.

## Common Tasks
-   **Changing the Model**: Edit `src/config.ts` to change the `modelName`.
-   **Clearing Cache**: Delete the `models/` directory to force a re-download of model weights.
-   **Port Configuration**: Default port is `3847`. Can be changed in `src/config.ts` or via environment variables (if implemented).
